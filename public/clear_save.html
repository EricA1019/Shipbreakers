<!DOCTYPE html>
<html>
<head>
  <title>Clear Ship Breakers Save</title>
  <style>
    body {
      font-family: monospace;
      background: #18181b;
      color: #fef3c7;
      padding: 2rem;
      max-width: 600px;
      margin: 0 auto;
    }
    h1 { color: #f59e0b; border-bottom: 2px solid #f59e0b; padding-bottom: 0.5rem; }
    button {
      background: #f59e0b;
      color: #18181b;
      border: none;
      padding: 1rem 2rem;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      margin: 1rem 0;
    }
    button:hover { background: #fbbf24; }
    pre {
      background: #27272a;
      padding: 1rem;
      border: 1px solid #f59e0b33;
      overflow-x: auto;
      white-space: pre-wrap;
    }
    .warning {
      background: #7c2d12;
      border: 1px solid #c2410c;
      padding: 1rem;
      margin: 1rem 0;
    }
    .success { color: #4ade80; }
    .info { color: #60a5fa; }
  </style>
</head>
<body>
<h1>üóëÔ∏è Clear Ship Breakers Save</h1>

<div class="warning" id="origin-warning" style="display:none">
  <strong>‚ö†Ô∏è Origin Mismatch!</strong><br>
  This page must be accessed via <code>http://localhost:5174/clear_save.html</code> to clear save data properly.
  <br><br>
  <a href="http://localhost:5174/clear_save.html" style="color:#fbbf24">Click here to open correctly</a>
</div>

<button onclick="clearSave()">üóëÔ∏è Clear All Save Data</button>
<pre id="output">Ready to clear save data...\n\nThis will:\n- Remove all Ship Breakers localStorage\n- Remove auto-salvage presets\n- Clear IndexedDB databases\n- Redirect to fresh game</pre>

<script>
// Must match src/services/SaveService.ts (STORE_STORAGE_KEY)
const STORE_STORAGE_KEY = 'ship-breakers-store-v1';

// Check if we're on the correct origin
window.addEventListener('load', () => {
  const origin = window.location.origin;
  const output = document.getElementById('output');
  const warning = document.getElementById('origin-warning');
  
  if (origin.startsWith('file://')) {
    warning.style.display = 'block';
    output.textContent = '‚ùå ERROR: Cannot clear save from file:// origin!\n\n' +
      'localStorage is per-origin. This page is running from:\n' +
      origin + '\n\n' +
      'But the game runs on http://localhost:5174\n\n' +
      'Please access this page via:\nhttp://localhost:5174/clear_save.html';
  } else {
    output.textContent += '\n\n‚úì Origin: ' + origin;
  }
});

async function clearSave() {
  const output = document.getElementById('output');
  const origin = window.location.origin;
  
  // Block if wrong origin
  if (origin.startsWith('file://')) {
    output.textContent = '‚ùå Cannot clear from file:// origin!\n\nPlease use http://localhost:5174/clear_save.html';
    return;
  }
  
  output.textContent = 'üîÑ Clearing save data...\n\n';
  
  try {
    // Clear all Ship Breakers localStorage keys
    const keys = Object.keys(localStorage);
    let clearedCount = 0;
    keys.forEach(key => {
      if (key === STORE_STORAGE_KEY || key.includes('autoSalvage_')) {
        localStorage.removeItem(key);
        output.textContent += '‚úì Removed: ' + key + '\n';
        clearedCount++;
      }
    });
    
    if (clearedCount === 0) {
      output.textContent += '(No Ship Breakers keys found)\n';
    }
    output.textContent += '\nüì¶ Cleared ' + clearedCount + ' localStorage keys\n\n';
    
    // Clear IndexedDB
    if (indexedDB.databases) {
      const dbs = await indexedDB.databases();
      for (const db of dbs) {
        if (db.name) {
          indexedDB.deleteDatabase(db.name);
          output.textContent += '‚úì Deleted IndexedDB: ' + db.name + '\n';
        }
      }
    }
    
    output.textContent += '\n‚úÖ Save data cleared!\n\nüöÄ Redirecting to game in 2 seconds...';
    setTimeout(() => window.location.href = '/', 2000);
  } catch (e) {
    output.textContent += '\n‚ùå Error: ' + e.message + '\n';
  }
}
</script>
</body>
</html>
